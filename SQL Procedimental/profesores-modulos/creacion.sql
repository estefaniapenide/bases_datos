
DROP TABLE IF EXISTS especialidades CASCADE;
CREATE TABLE especialidades (
	cod INT PRIMARY KEY,
	nombre VARCHAR(200) NOT NULL UNIQUE
);

INSERT INTO especialidades VALUES (590107, 'Informática');
INSERT INTO especialidades VALUES (591227, 'Sistemas e aplicacións informáticas');
INSERT INTO especialidades VALUES (590105, 'Formación e orientación laboral');
INSERT INTO especialidades VALUES (590022, 'Matemáticas');


DROP TABLE IF EXISTS ciclos CASCADE;
CREATE TABLE ciclos (
	cod CHAR(5) PRIMARY KEY,
	nombre VARCHAR(200) NOT NULL UNIQUE
);

INSERT INTO ciclos VALUES ('SMR', 'Sistemas microinformáticos e redes');
INSERT INTO ciclos VALUES ('ASIR', 'Administración de sistemas informáticos en rede');
INSERT INTO ciclos VALUES ('DAM', 'Desenvolvemento de aplicacións multiplataforma');
INSERT INTO ciclos VALUES ('DAW', 'Desenvolvemento de aplicacións web');


DROP TYPE IF EXISTS curso CASCADE;
CREATE TYPE curso AS ENUM ('1º', '2º');

DROP TABLE IF EXISTS modulos CASCADE;
CREATE TABLE modulos (
	cod CHAR(6) UNIQUE PRIMARY KEY,
	curso curso NOT NULL,
	siglas CHAR(8) NOT NULL,
	nombre VARCHAR(100) NOT NULL,
	sesiones_anuales SMALLINT NOT NULL,
	especialidad INT, /* Aquellos que están a NULL se consideran impartibles por cualquier especialidad */
	FOREIGN KEY (especialidad) REFERENCES especialidades(cod)
);

DROP TABLE IF EXISTS prerrequisitos CASCADE;
CREATE TABLE prerrequisitos (
	prerrequisito CHAR(6),
	modulo CHAR(6),
	FOREIGN KEY (modulo) REFERENCES modulos(cod),
	FOREIGN KEY (prerrequisito) REFERENCES modulos(cod),
	PRIMARY KEY (modulo, prerrequisito)
);

DROP TABLE IF EXISTS profesores CASCADE;
CREATE TABLE profesores (
	id SMALLINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nif CHAR(20) NOT NULL,
    nombre VARCHAR(400) NOT NULL,
    apellido1 VARCHAR(100) NOT NULL,
    apellido2 VARCHAR(100),
    fecha_incorporación DATE DEFAULT current_date,
    especialidad INT NOT NULL,
    FOREIGN KEY (especialidad) REFERENCES especialidades(cod),
   	salario DECIMAL(7,2) NOT NULL
);

INSERT INTO profesores VALUES (101, '11222333A', 'George', 'Boole', NULL, '1986-09-16', 590107, 3000);
INSERT INTO profesores VALUES (102, '12222333A', 'Georg', 'Cantor', NULL, '1986-09-16', 590107, 3000);
INSERT INTO profesores VALUES (103, '13222333A', 'Rudolf', 'Carnap', NULL, '1988-09-16', 590107, 2890);
INSERT INTO profesores VALUES (104, '14222333A', 'Alonzo', 'Church', NULL, '1990-09-16', 590107, 2993);
INSERT INTO profesores VALUES (105, '15222333A', 'Augustus', 'DeMorgan', NULL, '1990-09-16', 590107, 2888);
INSERT INTO profesores VALUES (106, '16222333A', 'Gottlob', 'Frege', NULL, '1990-09-16', 590107, 2789);
INSERT INTO profesores VALUES (107, '17222333A', 'Karl Friedrich', 'Gauss', NULL, '1990-09-16', 590107, 2743);
INSERT INTO profesores VALUES (108, '18222333A', 'David', 'Hilbert', NULL, '1992-09-16', 590107, 2679);
INSERT INTO profesores VALUES (109, '19222333A', 'Grace', 'Hopper', NULL, '1992-09-16', 590107, 2666);
INSERT INTO profesores VALUES (110, '10222333A', 'Gottfried', 'Leibniz', NULL, '1994-09-16', 590107, 2555);

INSERT INTO profesores VALUES (201, '11122333A', 'Claude', 'Shannon', NULL, '1994-09-16', 590107, 2508);
INSERT INTO profesores VALUES (202, '11322333A', 'Dennis', 'Ritchie', NULL , '1994-09-16', 590107, 2500);
INSERT INTO profesores VALUES (203, '11422333A', 'Tim', 'Berners-Lee', NULL, '1996-09-16', 590107, 2400);
INSERT INTO profesores VALUES (204, '11522333A', 'Kurt', 'Godel', NULL, '1996-09-16', 590107, 2440);
INSERT INTO profesores VALUES (205, '11622333A', 'Alan', 'Turin', NULL, '1996-09-16', 590107, 2498);
INSERT INTO profesores VALUES (206, '11722333A', 'John', 'Von Neumann', NULL, '1996-09-16', 590107, 2505);
INSERT INTO profesores VALUES (207, '11822333A', 'John', 'McCarthy', NULL, '1996-09-16', 590107, 2400);
INSERT INTO profesores VALUES (208, '11922333A', 'Linus', 'Torvalds', NULL, '1999-09-16', 590107, 2300);
INSERT INTO profesores VALUES (209, '11022333A', 'Alejandro', 'Vidal', NULL, '2019-09-16', 590107, 1950);
INSERT INTO profesores VALUES (210, '11992333A', 'Alan', 'Kay', NULL, '1999-09-16', 590107, 2289);

INSERT INTO profesores VALUES (301, '11222333A', 'Ada', 'Lovelace', NULL, '1088-09-16', 591227, 2145);
INSERT INTO profesores VALUES (302, '11222334A', 'G.E.', 'Moore', NULL, '1089-09-16', 591227, 2000);
INSERT INTO profesores VALUES (303, '11222335A', 'Willard V.', 'Quine', NULL, '1090-09-16', 591227, 2100);
INSERT INTO profesores VALUES (304, '11222336A', 'Bertrand', 'Russell', NULL, '1092-09-16', 591227, 2090);
INSERT INTO profesores VALUES (305, '11222337A', 'Saul', 'Kripke', NULL, '1099-09-16', 591227, 1900);
INSERT INTO profesores VALUES (306, '11222338A', 'Ludwig', 'Wittgenstein', NULL, '2019-09-16', 591227, 1700);
INSERT INTO profesores VALUES (307, '87329334S', 'Alejandro', 'Vidal', NULL, '2019-09-16', 590105, 2000);


DROP TYPE IF EXISTS regimen CASCADE;
CREATE TYPE regimen AS ENUM ('Ordinario', 'Adultos', 'Distancia', 'Dual');

DROP TABLE IF EXISTS modulos_ciclo CASCADE;
CREATE TABLE modulos_ciclo (
	codigo SMALLINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,  -- !!!
    ciclo CHAR(5) NOT NULL,
	regimen regimen NOT NULL,
	modulo CHAR(6) NOT NULL,
	sesiones SMALLINT NOT NULL, -- Sesiones semanales
    profesor SMALLINT,
	FOREIGN KEY (ciclo) REFERENCES ciclos(cod), 
	FOREIGN KEY (modulo) REFERENCES modulos(cod),
	FOREIGN KEY (profesor) REFERENCES profesores(id) ON DELETE SET NULL,
    UNIQUE (modulo, ciclo, regimen) -- !!!
);



/* SMR */

INSERT INTO modulos VALUES ('MP0221', '1º', 'MME', 'Montaxe e mantemento de equipamentos', 240, 591227);
INSERT INTO modulos VALUES ('MP0222', '1º', 'SOM', 'Sistemas operativos monoposto', 160, 591227);
INSERT INTO modulos VALUES ('MP0223', '1º', 'AO', 'Aplicacións ofimáticas', 240, 591227);
INSERT INTO modulos VALUES ('MP0225', '1º', 'RL', 'Redes locais', 213, 590107);
INSERT INTO modulos VALUES ('MP0229', '1º', 'FOL', 'Formación e orientación laboral', 107, 590105);

INSERT INTO modulos VALUES ('MP0224', '2º', 'SOR', 'Sistemas operativos en rede', 157, 591227);
INSERT INTO modulos VALUES ('MP0226', '2º', 'SGI', 'Seguridade informática', 140, 590107);
INSERT INTO modulos VALUES ('MP0227', '2º', 'SR', 'Servizos en rede', 157, 590107);
INSERT INTO modulos VALUES ('MP0228', '2º', 'AW', 'Aplicacións web', 123, 590107);
INSERT INTO modulos VALUES ('MP0230', '2º', 'EIE', 'Empresa e iniciativa emprendedora', 53, 590105);
INSERT INTO modulos VALUES ('MP0231', '2º', 'FCT', 'Formación en centros de traballo', 410, NULL);
INSERT INTO modulos VALUES ('Prueba', '2º', 'Mates', 'Modulo para prueba', 410, 590022);



INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('SMR', 'Adultos', 'MP0221', 9, 101);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('SMR', 'Adultos', 'MP0222', 6, 101);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('SMR', 'Adultos', 'MP0223', 9, 101);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('SMR', 'Adultos', 'MP0225', 8, 206);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('SMR', 'Adultos', 'MP0229', 4, 307);

INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('SMR', 'Adultos', 'MP0224', 6, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('SMR', 'Adultos', 'MP0226', 5, 207);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('SMR', 'Adultos', 'MP0227', 5, 206);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('SMR', 'Adultos', 'MP0228', 5, 210);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('SMR', 'Adultos', 'MP0230', 2, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('SMR', 'Adultos', 'MP0231', 3, NULL);

INSERT INTO prerrequisitos VALUES ('MP0222', 'MP0224');
INSERT INTO prerrequisitos VALUES ('MP0225', 'MP0224');
INSERT INTO prerrequisitos VALUES ('MP0225', 'MP0226');
INSERT INTO prerrequisitos VALUES ('MP0225', 'MP0227');
INSERT INTO prerrequisitos VALUES ('MP0225', 'MP0228');


/* ASIR */

INSERT INTO modulos VALUES ('MP0369', '1º', 'ISO', 'Implantación de sistemas operativos', 213, 591227);
INSERT INTO modulos VALUES ('MP0370', '1º', 'PAR', 'Planificación e administración de redes', 213, 590107);
INSERT INTO modulos VALUES ('MP0371', '1º', 'FH', 'Fundamentos de hardware', 107, 591227);
INSERT INTO modulos VALUES ('MP0372', '1º', 'XBD', 'Xestión de bases de datos', 187, 590107);
INSERT INTO modulos VALUES ('MP0373', '1º', 'LMSXI', 'Linguaxes de marcas e sistemas de xestión de información', 133, 590107);
INSERT INTO modulos VALUES ('MP0380', '1º', 'FOL', 'Formación e orientación laboral', 107, 590105);

INSERT INTO modulos VALUES ('MP0374', '2º', 'ASO', 'Administración de sistemas operativos', 140, 591227);
INSERT INTO modulos VALUES ('MP0375', '2º', 'SRI', 'Servizos de rede e internet', 140, 590107);
INSERT INTO modulos VALUES ('MP0376', '2º', 'IAW', 'Implantación de aplicacións web', 122, 590107);
INSERT INTO modulos VALUES ('MP0377', '2º', 'ASXBD', 'Administración de sistemas xestores de bases de datos', 70, 590107);
INSERT INTO modulos VALUES ('MP0378', '2º', 'SAD', 'Seguridade e alta dispoñibilidade', 105, 590107);
INSERT INTO modulos VALUES ('MP0381', '2º', 'EIE', 'Empresa e iniciativa emprendedora', 53, 590105);
INSERT INTO modulos VALUES ('MP0379', '2º', 'PFC-ASIR', 'Proxecto de administración de sistemas informáticos en rede', 26, NULL);
INSERT INTO modulos VALUES ('MP0382', '2º', 'FCT', 'Formación en centros de traballo', 384, NULL);

INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('ASIR', 'Adultos', 'MP0369', 8, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('ASIR', 'Adultos', 'MP0370', 8, 207);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('ASIR', 'Adultos', 'MP0371', 4, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('ASIR', 'Adultos', 'MP0372', 7, 205);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('ASIR', 'Adultos', 'MP0373', 5, 208);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('ASIR', 'Adultos', 'MP0380', 4, 307);

INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('ASIR', 'Adultos', 'MP0374', 4, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('ASIR', 'Adultos', 'MP0375', 4, 206);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('ASIR', 'Adultos', 'MP0376', 5, 210);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('ASIR', 'Adultos', 'MP0377', 3, 203);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('ASIR', 'Adultos', 'MP0378', 4, 207);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('ASIR', 'Adultos', 'MP0381', 4, 307);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('ASIR', 'Adultos', 'MP0379', 4, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('ASIR', 'Adultos', 'MP0382', 3, 207);


INSERT INTO prerrequisitos VALUES ('MP0369', 'MP0374');
INSERT INTO prerrequisitos VALUES ('MP0370', 'MP0375');
INSERT INTO prerrequisitos VALUES ('MP0370', 'MP0378');
INSERT INTO prerrequisitos VALUES ('MP0372', 'MP0377');


/* DAM */

INSERT INTO modulos VALUES ('MP0483', '1º', 'SI', 'Sistemas informáticos', 186, 591227);
INSERT INTO modulos VALUES ('MP0484', '1º', 'BD', 'Bases de datos', 187, 590107);
INSERT INTO modulos VALUES ('MP0485', '1º', 'PR', 'Programación', 240, 590107);
INSERT INTO modulos VALUES ('MP0487', '1º', 'CD', 'Contornos de desenvolvemento', 107, 590107);
INSERT INTO modulos VALUES ('MP0493', '1º', 'FOL', 'Formación e orientación laboral', 107, 590105);

INSERT INTO modulos VALUES ('MP0486', '2º', 'AD', 'Acceso a datos', 157, 590107);
INSERT INTO modulos VALUES ('MP0488', '2º', 'DI', 'Desenvolvemento de interfaces', 140, 591227);
INSERT INTO modulos VALUES ('MP0489', '2º', 'PMDM', 'Programación multimedia e dispositivos móbiles', 123, 590107);
INSERT INTO modulos VALUES ('MP0490', '2º', 'PSP', 'Programación de servizos e procesos', 70, 590107);
INSERT INTO modulos VALUES ('MP0491', '2º', 'SXE', 'Sistemas de xestión empresarial', 87, 591227);
INSERT INTO modulos VALUES ('MP0494', '2º', 'EIE', 'Empresa e iniciativa emprendedora', 53, 590105);
INSERT INTO modulos VALUES ('MP0492', '2º', 'PFC-DAM', 'Proxecto de desenvolvemento de aplicacións multiplataforma', 26, NULL);
INSERT INTO modulos VALUES ('MP0495', '2º', 'FCT', 'Formación en centros de traballo', 384, NULL);


INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Adultos', 'MP0484', 7, 209);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Adultos', 'MP0483', 7, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Adultos', 'MP0487', 4, 204);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Adultos', 'MP0373', 5, 210);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Adultos', 'MP0485', 9, 208);

INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Adultos', 'MP0490', 3, 205);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Adultos', 'MP0491', 3, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Adultos', 'MP0488', 5, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Adultos', 'MP0489', 5, 209);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Adultos', 'MP0486', 6, 208);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Adultos', 'MP0493', 4, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Adultos', 'MP0494', 2, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Adultos', 'MP0492', 3, NULL);

INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Dual', 'MP0484', 7, 209);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Dual', 'MP0483', 7, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Dual', 'MP0487', 4, 204);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Dual', 'MP0373', 6, 201);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAM', 'Dual', 'MP0485', 7, 202);

INSERT INTO prerrequisitos VALUES ('MP0485', 'MP0486');
INSERT INTO prerrequisitos VALUES ('MP0485', 'MP0489');
INSERT INTO prerrequisitos VALUES ('MP0485', 'MP0490');
INSERT INTO prerrequisitos VALUES ('MP0485', 'MP0488');
INSERT INTO prerrequisitos VALUES ('MP0484', 'MP0486');
INSERT INTO prerrequisitos VALUES ('MP0484', 'MP0491');
INSERT INTO prerrequisitos VALUES ('MP0373', 'MP0489');


/* DAW */
INSERT INTO modulos VALUES ('MP0617', '1º', 'FOL', 'Formación e orientación laboral', 107, 590105);

INSERT INTO modulos VALUES ('MP0612', '2º', 'DWCC', 'Desenvolvemento web en contorno cliente', 157, 591227);
INSERT INTO modulos VALUES ('MP0613', '2º', 'DWCS', 'Desenvolvemento web en contorno servidor', 175, 590107);
INSERT INTO modulos VALUES ('MP0614', '2º', 'DAW', 'Despregamento de aplicacións web', 88, 590107);
INSERT INTO modulos VALUES ('MP0615', '2º', 'DIW', 'Deseño de interfaces web', 157, 591227);
INSERT INTO modulos VALUES ('MP0618', '2º', 'EIE', 'Empresa e iniciativa emprendedora', 53, 590105);
INSERT INTO modulos VALUES ('MP0616', '2º', 'PFC-DAW', 'Proxecto de desenvolvemento de aplicacións web', 26, NULL);
INSERT INTO modulos VALUES ('MP0619', '2º', 'FCT', 'Formación en centros de traballo', 384, NULL);

INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAW', 'Adultos', 'MP0484', 7, 205);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAW', 'Adultos', 'MP0483', 7, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAW', 'Adultos', 'MP0487', 4, 204);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAW', 'Adultos', 'MP0373', 5, 210);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAW', 'Adultos', 'MP0485', 9, 202);

INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAW', 'Adultos', 'MP0612', 7, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAW', 'Adultos', 'MP0613', 7, 204);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAW', 'Adultos', 'MP0614', 3, 110);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAW', 'Adultos', 'MP0615', 6, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAW', 'Adultos', 'MP0618', 7, NULL);
INSERT INTO modulos_ciclo (ciclo, regimen, modulo, sesiones, profesor) VALUES ('DAW', 'Adultos', 'MP0619', 3, 205);


INSERT INTO prerrequisitos VALUES ('MP0485', 'MP0613');
INSERT INTO prerrequisitos VALUES ('MP0484', 'MP0613');
INSERT INTO prerrequisitos VALUES ('MP0485', 'MP0612');
INSERT INTO prerrequisitos VALUES ('MP0373', 'MP0612');
INSERT INTO prerrequisitos VALUES ('MP0373', 'MP0615');
	












